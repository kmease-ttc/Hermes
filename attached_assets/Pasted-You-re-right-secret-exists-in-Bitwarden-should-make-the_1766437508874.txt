You’re right — **“secret exists in Bitwarden” should make the service at least “Ready to connect”** (or “Needs URL” if the secret only contains a key). The reason you’re seeing “Ready” for Orchestrator/Audit Log but “Needs Config” for the other workers is because Hermes is currently treating “ready” as:

* secret exists **and**
* secret contains the full worker connection config (**base_url + api_key**) **or** Hermes has some other fallback path

But your Bitwarden screenshot confirms the worker secrets are mostly **API-key-only strings**. That means Hermes *can see the secrets*, but it **still doesn’t know where those worker apps live**, so it can’t “connect” even though the key exists.

### So the fix is:

For each worker secret, you must store **base_url + api_key** (or store base_url separately). Otherwise Hermes can’t call the worker, period.

Right now only Google is “working” because it’s either:

* not a remote worker (runs inside Hermes), or
* has base_url configured elsewhere (hardcoded, env var, DB), so it passes “ready.”

---

# Developer instructions: Make all worker services show “Ready” when Bitwarden is populated

## Goal

Every worker listed in Bitwarden should show:

* **Ready** if Hermes has enough to call it (base_url + api_key)
* **Needs Config** if Hermes only has an API key (missing base_url)
* **Blocked** if it’s intentionally not built/approved (Google Ads, Change Executor)

And the UI should make it obvious *what’s missing*, not just show a generic “Needs Config.”

---

## 1) Update config-state logic to separate these states clearly

### New computed fields per service

* `secretPresent: boolean`
* `connectionConfigPresent: boolean` (base_url + api_key)
* `configState: ready | needs_config | blocked`
* `blockingReason: string`

### Rules

1. If service is `planned` / not built:

* `configState = blocked`
* `blockingReason = "Not built"`

2. Else if secret missing:

* `configState = needs_config`
* `blockingReason = "Bitwarden secret not found: <secretName>"`

3. Else if secret exists but **base_url missing**:

* `configState = needs_config`
* `blockingReason = "Worker base_url missing in Bitwarden secret"`

4. Else if base_url exists but health fails:

* `configState = needs_config`
* `blockingReason = "Worker unreachable or unauthorized (status=...)"`

5. Else:

* `configState = ready`

**Important:** “Ready” must not require the worker to return SEO outputs. Only “can connect.”

---

## 2) Standardize the Bitwarden secret value format for workers (required)

Right now your worker secrets are just API keys. Change them to JSON:

### Example for `SEO_SERP_&_Keyword`

```json
{
  "base_url": "https://<serp-worker>.replit.app",
  "api_key": "CURRENT_KEY_VALUE",
  "health_path": "/health",
  "start_path": "/api/run",
  "status_path": "/api/status"
}
```

### Example for `SEO_TECHNICAL_CRAWLER_API_KEY`

```json
{
  "base_url": "https://<crawler-worker>.replit.app",
  "api_key": "CURRENT_KEY_VALUE",
  "health_path": "/health"
}
```

Minimum required:

* `base_url`
* `api_key`

If you don’t add base_url, Hermes can’t connect and should display:

> Needs Config: Worker base_url missing in Bitwarden secret

---

## 3) Hermes BitwardenProvider must support JSON and raw string (backwards compatible)

When Hermes fetches a Bitwarden secret:

* Attempt JSON.parse
* If parse fails, treat it as:

  * `{ api_key: "<raw>" }`

Then:

* `base_url` will be missing → configState needs_config with clear reason.

This is how you can migrate gradually.

---

## 4) Update servicesCatalog mapping to use correct Bitwarden secret names

Each worker service must explicitly map to a Bitwarden secret name, including special characters:

* SERP worker → `SEO_SERP_&_Keyword`
* Crawler → `SEO_TECHNICAL_CRAWLER_API_KEY`
* Vitals → `SEO_Vital_Monitor`
* Competitive → `SEO_Competitive_Intel`
* Blog → `SEO_Blog_Writer`
* Backlinks → `SEO_Backlinks`
* etc.

No auto-guessing.

---

## 5) Add a “Fix Config” CTA directly in the Integrations row

For any service with:

* secretPresent = true
* base_url missing

Show a button:

* “Add base URL”

Clicking it opens a modal that explains:

* “This Bitwarden secret currently stores only an API key. Hermes also needs the worker’s base URL.”
* Provide the JSON template for copy/paste.

This will speed up your setup massively.

---

## 6) Why Orchestrator/Audit Log show Ready (and why that’s fine)

Those likely are:

* internal modules (no base_url needed), or
* already have base_url elsewhere

That’s okay. For workers, you need base_url.

---

# What you need to do right now (fastest path)

For each worker secret in Bitwarden, update the value from:

* `"some_api_key_string"`
  to:
* `{"base_url":"https://...","api_key":"some_api_key_string"}`

Start with:

1. `SEO_SERP_&_Keyword`
2. `SEO_TECHNICAL_CRAWLER_API_KEY`
3. `SEO_Vital_Monitor`
4. `SEO_Backlinks`
   …then the rest.

Once that’s done, Hermes will be able to show them as **Ready** and Test Connection will actually hit their `/health`.

---

If you want, paste the list of your worker app URLs (even just the Replit domains) and I’ll generate the exact JSON you should paste into each Bitwarden secret, matching the names in your screenshot.
