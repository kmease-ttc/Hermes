Got it — this is **not finished**, and the screenshot is the proof.

You’re landing on `/agents/natasha`, but the app is still producing **links or navigations to routes that are no longer canonical**, which is why you’re hitting **Agent Not Found** instead of a valid page or redirect. This means the earlier cleanup didn’t fully eliminate **hardcoded paths + post-action redirects**.

Below is the **exact corrective action** you should take next. This is not conceptual — this is the final hardening pass.

---

## What’s actually broken (root cause)

From the screenshot and behavior:

1. **Some routes are canonicalized, but navigation code still points to old paths**

   * Example: `/agents/:slug` vs `/crew/:slug` vs legacy paths
2. **Post-action redirects (after analysis, fix, etc.) are still using string paths**
3. **Sidebar links and in-app links are inconsistent**
4. The “Agent Not Found” page is rendering **instead of redirecting**, which means:

   * Router match fails
   * Redirect layer is incomplete or bypassed

This is a classic **“90% migrated routing”** problem.

---

## What needs to happen next (non-negotiable)

### 1. Pick ONE canonical agent route (final decision)

You already implicitly chose it:

**Canonical**

```
/agents/:agentSlug
```

Everything else must redirect **to this**.

---

### 2. Enforce a single route builder (this is the missing piece)

Create or verify this file exists and is used everywhere:

```ts
// shared/routes.ts
export const routes = {
  agents: {
    list: () => `/agents`,
    detail: (slug: string) => `/agents/${slug}`,
  },
  missionControl: () => `/mission-control`,
};
```

**Rule:**
❌ No `"/agents/natasha"`
❌ No `"/crew/natasha"`
✅ Only `routes.agents.detail(slug)`

---

### 3. Kill all hardcoded navigations (this is where it’s failing)

Search **the entire repo** for:

* `navigate(`
* `router.push(`
* `href="/agents`
* `href="/crew`
* `"/agents/"`
* `"/crew/"`

Every one of these must be replaced.

Example fix:

```ts
// ❌ BAD
navigate(`/agents/${agent.slug}`);

// ✅ GOOD
navigate(routes.agents.detail(agent.slug));
```

This includes:

* Buttons
* Table row clicks
* “Run Analysis” completion handlers
* “Fix it” actions
* Sidebar items

---

### 4. Fix post-action redirects (this is causing the screenshot)

Anywhere you do this:

```ts
onComplete(() => navigate('/agents/natasha'));
```

Replace with **safe navigation**:

```ts
onComplete(() => {
  navigate(routes.agents.detail(currentAgent.slug));
});
```

If the agent context is missing, fallback:

```ts
navigate(routes.agents.list());
```

---

### 5. Make the redirect layer catch EVERYTHING

In your router config (or server middleware), add **parameterized redirects**:

#### Client-side (React Router example)

```tsx
<Route path="/crew/:slug" element={<Navigate to="/agents/:slug" replace />} />
<Route path="/crew" element={<Navigate to="/agents" replace />} />
```

#### Server-side (preferred if you have it)

* `/crew/*` → `/agents/*` (302 initially)

**Important:** preserve params and query strings.

---

### 6. Upgrade the “Agent Not Found” behavior

Right now it’s a dead end. It should self-heal.

Change logic to:

* If agent slug is invalid:

  * Show message
  * Auto-redirect to `/agents` after ~1–2s
  * Button stays as backup

This ensures **no hard dead ends** even if something slips through.

---

## Acceptance test (do this manually)

After implementing the above, ALL of these must work:

* `/agents/natasha` → loads Natasha
* `/crew/natasha` → redirects → loads Natasha
* Clicking Natasha in sidebar → loads Natasha
* Running analysis → stays on Natasha
* Clicking “Fix it” → stays on Natasha
* Refreshing page → stays on Natasha
* No “Agent Not Found” unless slug truly doesn’t exist

If **any** of those fail, there is still a hardcoded path somewhere.

---

## Final commit message (when done)

```
fix(routing): eliminate dead agent URLs and enforce canonical agent routes
```

---

If you want, next step I can:

* Give you a **one-line grep command** that will catch every remaining bad route
* Or help you design a **runtime guard** that throws if someone tries to navigate using a raw string

But you’re absolutely right — this needs to be **100% clean**, not “mostly works.”
