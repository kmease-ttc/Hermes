Great, next step is:

Step 2 – Turn the intake endpoint into a real pipeline with DB + job queue + worker that creates a stub preview site.

Think of it as:
“Submit form → create User + Site + Job in DB → worker picks Job → sets preview_url → (later) we’ll email.”

Below are dev instructions you can hand off.

Step 2 – Implement DB models, intake pipeline, and worker stub

Goal
Replace the fake /api/intake logger with:
	•	Real persistence (User, Site, Job tables)
	•	A simple job queue in the DB
	•	A worker loop that creates a fake preview URL and marks the Site as ready

You still won’t have auth, magic links, or real site generation yet. This is just the scaffolding.
	1.	Add a database to /app and /worker

Use SQLite for now (simple and fine for first versions):

In /app:
	•	Add a DB module (for example using Prisma, Drizzle, or raw SQL – you choose).
	•	Create a single SQLite file, for example: /app/data/arclo.db.
	•	Make sure /worker uses the same DB file (via env var, e.g. APP_DB_URL).

Schema (minimum):

User
	•	id (UUID or integer PK)
	•	email (string, unique)
	•	password_hash (string, nullable for now)
	•	status (string: ‘invited’ | ‘active’)
	•	created_at (datetime)

Site
	•	id (UUID or integer PK)
	•	user_id (nullable for now; we don’t attach a user yet)
	•	business_name (string)
	•	city (string, nullable)
	•	niche (string, nullable)
	•	status (string: ‘preview_pending’ | ‘preview_ready’ | ‘live_pending_dns’ | ‘live’)
	•	preview_url (string, nullable)
	•	created_at (datetime)

Job
	•	id (UUID or integer PK)
	•	type (string, e.g. ‘generate_preview_site’)
	•	payload_json (text)
	•	status (string: ‘queued’ | ‘running’ | ‘done’ | ‘error’)
	•	run_after (datetime)
	•	created_at (datetime)
	•	updated_at (datetime)

	2.	Update /api/intake to create User, Site, Job

In /app:

Route: POST /api/intake

Expected payload (from marketing site):

{
“email”: “owner@example.com”,
“businessName”: “Empathy Health Clinic”,
“city”: “Orlando, FL”,
“niche”: “Psychiatry / Therapy”,
“hasExistingSite”: true,
“imageMode”: “upload” | “ai”
}

Steps:
	1.	Validate body (basic required fields: email, businessName).
	2.	Upsert user:
	•	Look up user by email.
	•	If none, create one:
	•	email = provided email
	•	status = ‘invited’
	•	password_hash = null
	3.	Create site:
	•	user_id = null for now (we’ll attach later when they sign up)
	•	business_name = businessName
	•	city, niche from request
	•	status = ‘preview_pending’
	•	preview_url = null
	4.	Create job:
	•	type = ‘generate_preview_site’
	•	payload_json = JSON.stringify({ siteId: newSite.id })
	•	status = ‘queued’
	•	run_after = now()
	5.	Return:
	•	{ ok: true }

Acceptance for this part:
	•	POST /api/intake creates rows in User, Site, Job tables.
	•	If you call it twice with the same email, you get:
	•	one User row
	•	two Site rows
	•	two Job rows

	3.	Implement the worker job loop

In /worker:

Use the same DB schema and connection as /app (point to the same SQLite file).

Worker behavior (v1):
	•	Every 10 seconds:
	•	Find one Job with:
	•	status = ‘queued’
	•	run_after <= now()
	•	(ORDER BY created_at ASC LIMIT 1)
	•	If no job, sleep.
	•	If found:
	•	Set status = ‘running’
	•	Process based on type.
	•	On success: set status = ‘done’, updated_at = now().
	•	On error: set status = ‘error’, updated_at = now(), log error.

Processing generate_preview_site:
	•	Parse payload_json to get { siteId }.
	•	Lookup Site by id.
	•	If not found: mark job error.
	•	If found:
	•	Set:
	•	site.preview_url = “https://preview.arclo.dev/site-” + siteId  (placeholder)
	•	site.status = ‘preview_ready’
	•	Save site.
	•	Log to console: Preview site generated for site ${siteId} at ${preview_url}.
	•	(Later we’ll send email here. For now just log.)

Acceptance for worker:
	•	Start worker, leave it running.
	•	Trigger /api/intake.
	•	Within ~10 seconds, you should see logs from the worker indicating it processed a generate_preview_site job and set a preview_url.
	•	DB reflects:
	•	Site.status transitions from preview_pending → preview_ready
	•	preview_url is non-null

	4.	Wire marketing form to new intake payload

In /marketing-site:
	•	Ensure the “Generate My Website” form sends the full JSON payload expected by /api/intake:
	•	email
	•	businessName
	•	city
	•	niche
	•	hasExistingSite
	•	imageMode
	•	After a successful 200 response, show a confirmation:
	•	“We’re generating your preview website. You’ll get an email when it’s ready.”

(Email sending will be implemented later; for now you can just trust the backend.)
	5.	End-to-end test for Step 2

In dev:
	1.	Start /app.
	2.	Start /worker.
	3.	Start /marketing-site with APP_BASE_URL pointing at /app.
	4.	Go to the marketing site, submit the “Generate My Website” form.
	5.	Check:
	•	/app logs: POST /api/intake called.
	•	DB: User, Site, Job rows exist.
	•	/worker logs: picked up a generate_preview_site job and created a preview_url.
	•	DB: Site.status is now preview_ready with a non-null preview_url.

Once this is solid, the next step will be Step 3: magic-link signup + auth + preview page that reads that preview_url and shows it behind a login.