Developer instructions: implement a “fast-first, upgrade-later” asset pipeline

A) New workflow states
Add explicit site build states so the UI can behave predictably:

DRAFT_READY (stock images + fast logo placeholder; preview URL available)

UPGRADING_ASSETS (optional background generation running)

FINAL_READY (custom logo/hero swapped in; preview updated)

FAILED (with reason + fallback retained)

B) Frontend UX changes (reduce abandonment)

After form submit, show a progress UI with 2 milestones:

“Building your site…” (fast path) -> should complete in under 60 seconds

“Optional: upgrading images/logo…” (background)

The moment DRAFT_READY is available, show:

“Open your site now” button (preview)

Keep email collection as optional or “we’ll also email you a link” (but don’t rely on it)

C) Fast path: stock photo selection algorithm
Goal: pick a hero image + supporting images that are (1) relevant, (2) high quality, (3) not overused, (4) varied.

Generate industry context keywords
Inputs: business_name, category/industry, services list, city, tone
Create a keyword set like:

Primary: [industry], [industry + “small business”], [service], [service + “professional”]

Secondary: [city + industry], [industry + “interior”], [industry + “team”], [industry + “customer”]

Avoid junk terms that cause generic office photos (“corporate”, “meeting”, “laptop”) unless the industry actually wants that.

Query diversification
Instead of one query, do 6–12 queries and pool results:

q1: industry + main service

q2: industry + “exterior”

q3: industry + “interior”

q4: industry + “customer”

q5: “tools”/“workspace” specific to the industry (e.g., bakery: “artisan bread”, “pastry chef”, “bakery display”)

q6: city + industry (optional)
Then randomly sample with weights.

Source diversification

Unsplash API search

Pexels API search

(Optional paid) Shutterstock/Adobe Stock if you want premium uniqueness

Uniqueness enforcement across customers
Store selections in DB:

table: site_assets

site_id

asset_type (hero, about, services, etc.)

source (unsplash/pexels/…)

source_asset_id

url_original

url_cached (your CDN/object storage)

perceptual_hash (phash)

industry

created_at
And a table for global usage:

table: asset_usage

source

source_asset_id

industry

last_used_at

use_count_30d
Selection rule:

Reject assets used in last X days for the same industry (e.g., 30 days)

Prefer assets with lowest recent use_count_30d

Reject near-duplicates by phash distance threshold (so you don’t pick visually similar images)

Make stock assets feel custom (fast transforms)
When caching the selected image to your storage, generate 2–3 variants:

Hero crop: 16:9 and 21:9 focal crop

Mobile crop: 4:5 or 9:16

Apply a subtle, consistent brand overlay:

gradient overlay (based on palette)

slight contrast curve

optional blur on edges for hero background
This keeps performance fast but creates differentiation.

Implementation detail:

Use a fast image pipeline (Sharp in Node) in your worker/service.

Cache final assets in object storage and reference your cached URLs in the site config.

D) Fast logo fallback (so you don’t block on logo gen)
Instead of generating a full logo during the critical path:

Create a “brand mark” instantly:

monogram (first letter(s))

clean wordmark text rendering using 1–2 curated fonts

color derived from palette
This can be deterministic and instant.
Then, optionally replace later with AI-generated logo.

E) Background upgrade (optional, but recommended)
Once DRAFT_READY is live:

Kick off async jobs:

AI hero generation (if you still want it)

AI logo generation (if you still want it)

When finished, atomically update site config:

swap heroImageUrl/logoUrl

bump a config version number

Notify user:

in-app toast/banner if they’re still on the page

email as secondary: “Your upgraded version is ready” with the same preview link

F) Performance targets + guardrails

Hard timeout for fast path: 60 seconds

If stock fetch is slow, fall back to a pre-curated local library per industry (your own set of 200–500 images) and then refresh later.

Never block the preview on email send.

Always show the preview link on-page and allow copy.

G) Instrumentation (so you can prove the drop-off and fix it)
Track:

form_submit

draft_ready_time_seconds

preview_opened

final_ready

email_sent, email_delivered (SendGrid events), email_open/click

spam complaints / bounces
Then compare:

instant-preview cohort vs email-only cohort
This will quantify abandonment and show the ROI of the fast-first pipeline.

Replit implementation prompt (paste to your dev/agent)
Build a fast-first site generation flow. On submit, generate a previewable site in <60s using stock photos + instant logo fallback (monogram/wordmark). Do not wait for AI logo/hero generation. Persist selected stock assets in DB with source + id + perceptual hash; enforce uniqueness by avoiding recently used assets for the same industry and rejecting near-duplicates via phash distance. Use diversified search queries across Unsplash and Pexels, then cache selected images to object storage and generate hero/mobile crops via Sharp with a subtle brand gradient overlay. Expose build states (DRAFT_READY, UPGRADING_ASSETS, FINAL_READY, FAILED). After DRAFT_READY, optionally kick off background jobs to generate AI hero/logo and swap into the site config when complete; notify in-app and send an email as secondary. Add analytics for submit->draft_ready latency, preview_open, email deliverability events, and conversion.