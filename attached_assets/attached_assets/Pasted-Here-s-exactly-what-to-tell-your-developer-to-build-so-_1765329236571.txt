Here’s exactly what to tell your developer to build so you always know when someone tries to generate a site and whether it worked.

````{"variant":"standard","id":"59301","title":"Implementation instructions for internal email notifications"}
Goal  
1) Every time someone submits the “generate website” form, send an internal email to support@arclo.pro saying “someone tried.”  
2) When generation finishes, send a second internal email saying either SUCCESS or FAILURE (with error details).  
3) Keep sending the normal “your site is ready” email to the user as it does today.

Assumptions  
- We already have a SendGrid-powered helper in shared/email.ts.  
- We now use the SENDGRID_API_KEY secret (not the Replit connector key).

Step 1 – Add a support email constant  
In shared/email.ts:

```ts
const SUPPORT_EMAIL = "support@arclo.pro";
```

Step 2 – Add a generic internal notification helper  
In the same file, add something like:

```ts
type SiteGenerationEventType = "REQUESTED" | "SUCCESS" | "FAILED";

interface SiteGenerationEventPayload {
  userEmail: string | null;
  userName?: string | null;
  formData?: Record<string, any>;
  jobId?: string;
  siteUrl?: string | null;
  createdAt?: string; // ISO timestamp
  errorMessage?: string | null;
}

export async function sendInternalSiteGenerationNotification(
  type: SiteGenerationEventType,
  payload: SiteGenerationEventPayload
) {
  const timestamp = new Date().toISOString();

  const subject = `[Arclo] Site generation ${type} – ${payload.userEmail ?? "Unknown user"}`;

  const textLines = [
    `Event: ${type}`,
    `Timestamp: ${timestamp}`,
    `User Email: ${payload.userEmail ?? "N/A"}`,
    `User Name: ${payload.userName ?? "N/A"}`,
    `Job ID: ${payload.jobId ?? "N/A"}`,
    `Site URL: ${payload.siteUrl ?? "N/A"}`,
    "",
    "Form Data:",
    JSON.stringify(payload.formData ?? {}, null, 2),
  ];

  if (payload.errorMessage) {
    textLines.push("", "Error:", payload.errorMessage);
  }

  await sgMail.send({
    to: SUPPORT_EMAIL,
    from: {
      email: "no-reply@arclo.pro", // keep whatever you’re already using as the verified sender
      name: "Arclo",
    },
    subject,
    text: textLines.join("\n"),
  });
}
```

(If you’re using a different email helper, keep the same structure but plug into that.)

Step 3 – Call it when the user submits the form (“attempt” email)  
Find the API handler that runs when the user clicks “Generate site” (something like server/routes/generateSite.ts or app/api/generate-site.ts).

Right after you validate the request and before you enqueue the job / call the AI:

```ts
// Example – adjust to your actual types/variables
const { email, name, ...restFormData } = body;
const job = await queueSiteGenerationJob({ email, name, ...restFormData });

await sendInternalSiteGenerationNotification("REQUESTED", {
  userEmail: email ?? null,
  userName: name ?? null,
  formData: restFormData,
  jobId: job.id,
  createdAt: new Date().toISOString(),
});
```

This guarantees: as soon as someone tries, support@arclo.pro gets an email, even if the job later fails.

Step 4 – Call it from the worker on success  
In the worker/process that actually generates the site (e.g. worker/jobs/generateSite.ts):

```ts
import { sendInternalSiteGenerationNotification, sendUserSiteReadyEmail } from "../shared/email"; // adjust path

export async function handleSiteGenerationJob(job: SiteGenerationJob) {
  const { userEmail, userName } = job;

  try {
    const siteUrl = await generateSite(job); // your existing logic

    // 1) Email the user (existing behavior)
    await sendUserSiteReadyEmail(userEmail, siteUrl);

    // 2) Internal success notification
    await sendInternalSiteGenerationNotification("SUCCESS", {
      userEmail,
      userName,
      formData: job,      // or a subset if job contains sensitive data
      jobId: job.id,
      siteUrl,
      createdAt: new Date().toISOString(),
    });
  } catch (err: any) {
    const errorMessage =
      err?.message || (typeof err === "string" ? err : "Unknown error");

    // Internal failure notification – this is the important part so failures are never silent
    try {
      await sendInternalSiteGenerationNotification("FAILED", {
        userEmail: job.userEmail ?? null,
        userName: job.userName ?? null,
        formData: job,
        jobId: job.id,
        siteUrl: null,
        createdAt: new Date().toISOString(),
        errorMessage,
      });
    } catch {
      // ensure we don't crash the worker just because internal email failed
      console.error("[Email] Failed to send internal failure notification");
    }

    // Keep your existing logging / error handling
    console.error("[Site Generation] Job failed", { jobId: job.id, errorMessage });
    throw err;
  }
}
```

Result:  
- When a user clicks “Generate Website”:  
  - Internal email to support@arclo.pro with REQUESTED, their email, and submitted form data.  
- When generation completes successfully:  
  - User still gets the “your site is ready” email.  
  - Internal email to support@arclo.pro with SUCCESS and the generated URL.  
- When generation fails for any reason:  
  - Internal email to support@arclo.pro with FAILED and the error message + payload.  
  - You can see exactly who tried and why it failed instead of silent errors.

Step 5 – Optional: tag subject lines for easy filtering  
If you want to filter in Gmail/Helpdesk later, tweak the subject in sendInternalSiteGenerationNotification:

```ts
const subject = `[Arclo][SiteGeneration][${type}] ${payload.userEmail ?? "Unknown user"}`;
```

That’s all your dev should need. Once this is wired in, you’ll see an email for every attempt plus a follow-up email for success/failure, instead of silent failures.  
````
