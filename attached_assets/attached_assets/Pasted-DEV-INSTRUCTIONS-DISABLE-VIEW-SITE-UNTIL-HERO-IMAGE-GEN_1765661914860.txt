DEV INSTRUCTIONS — DISABLE “VIEW SITE” UNTIL HERO IMAGE GENERATION COMPLETES

Problem
Users can click “View site” while the hero image is still generating, so they see a placeholder. That makes the product feel broken.

Goal
Only allow “View site” (and/or “Continue”) once the hero image is finalized OR provide a clearly-labeled “Preview (placeholder)” mode. Default should be: block until ready.

⸻

A) DEFINE A RELIABLE “HERO READY” SIGNAL (SOURCE OF TRUTH)
	1.	Add/confirm fields on the generated site record
On the server-side entity that represents the generated site (Site / Project / Website):

	•	hero_image_status: enum = pending | generating | ready | failed
	•	hero_image_url: string nullable
	•	hero_image_updated_at: timestamp
Optional but useful:
	•	hero_image_error: string nullable
	•	hero_image_placeholder_url: string nullable (if you want previews)

	2.	Set status transitions

	•	When generation is kicked off: hero_image_status = generating
	•	When image successfully saved to storage/CDN: set:
	•	hero_image_url = final_url
	•	hero_image_status = ready
	•	If generation fails: hero_image_status = failed and set hero_image_error

Acceptance criteria
	•	At any time, the frontend can query one field and know if hero is usable.

⸻

B) FRONTEND GATING LOGIC (DISABLE VIEW SITE)
	3.	Gate the “View site” button using hero readiness
In the review step component:

	•	Fetch site status (or use existing site object) that includes hero_image_status
	•	Disable button if status is not ready

Rules:
	•	If hero_image_status !== "ready":
	•	Disable “View site”
	•	Show loading text and spinner: “Generating hero image…”
	•	Show subtle helper copy: “This usually takes ~30–60 seconds.”

	4.	Add polling (or SSE/Websocket) to update the UI automatically
Simplest: polling.

	•	Poll endpoint every 2–3 seconds for up to 90 seconds:
	•	GET /api/sites/{id}/status returning hero_image_status, hero_image_url
	•	Stop polling when:
	•	status becomes ready or failed
	•	user navigates away

Implementation requirements
	•	Use exponential backoff after 30 seconds (e.g., 2s → 3s → 5s)
	•	Clear interval on unmount
	•	Avoid polling if the status is already ready

Acceptance criteria
	•	Button becomes enabled automatically as soon as hero is ready without refresh.

⸻

C) HANDLE FAILURE GRACEFULLY (DON’T BLOCK FOREVER)
	5.	If hero generation fails, give the user a path forward
If hero_image_status === "failed":

	•	Show an error banner in the review step:
“We couldn’t generate your hero image yet.”
Buttons:
	•	“Retry hero image” (calls a retry endpoint)
	•	“View site anyway” (allowed, but label it clearly)

	6.	Add a hard timeout on “generating” state
If still generating after 90 seconds:

	•	Show:
“Still working… you can keep waiting or view the site with a placeholder.”
Buttons:
	•	“Keep waiting”
	•	“View site anyway”

This prevents dead-end UX.

⸻

D) BACKEND RETRY ENDPOINT
	7.	Add an endpoint to retry hero generation

	•	POST /api/sites/{id}/hero/retry
Server behavior:
	•	Validate ownership
	•	Set hero_image_status = generating
	•	Enqueue regeneration job
	•	Return updated status

⸻

E) OPTIONAL: ALLOW “PREVIEW MODE” WITHOUT HURTING TRUST

If you truly want immediate previews sometimes:
	•	Rename the button while generating:
	•	Primary disabled: “Generating hero image…”
	•	Secondary link (optional): “Preview now (placeholder)”
This makes it explicit and avoids “buggy” perception.

⸻

Definition of done
	•	“View site” is disabled until hero_image_status === ready
	•	UI polls status and enables automatically
	•	Failure/timeout has a clear recovery path (retry or preview anyway)
	•	No user can accidentally see placeholder hero unless they explicitly choose to preview early