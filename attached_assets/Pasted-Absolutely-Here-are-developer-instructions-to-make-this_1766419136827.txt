Absolutely. Here are **developer instructions** to make this Integrations dashboard **truthful and useful**, specifically fixing:

* Bitwarden shows “not connected” even when it is
* Remove “Base URL / Not configured” noise (unless in an advanced view)
* Show **Last Run** in a way that actually reflects reality
* Clicking a service opens the **Service Explainer + Last Run summary + Run history + What it pulled back**

---

## 0) Redefine the purpose of this page (so the UI matches your brain)

This page is your **Nervous System**. It should answer:

1. What ran last? When? For which site? Did it succeed?
2. What did it do and what did it return?
3. What’s failing or missing outputs?
4. Where do I need to improve a service?

Everything else is secondary and should be hidden behind “Diagnostics”.

---

## 1) Fix Bitwarden “Not connected” — make it reflect the real status

### Backend: implement a single source-of-truth status check

Create:
`GET /api/platform/dependencies`

Return:

```json
{
  "bitwarden": { "connected": true, "reason": null, "secretsFound": 14, "lastCheckedAt": "...", "httpStatus": 200 },
  "postgres": { "connected": true, "reason": null, "lastCheckedAt": "..."}
}
```

### Bitwarden status logic

* Call Bitwarden using `BWS_ACCESS_TOKEN` + `BWS_PROJECT_ID`
* If the API call succeeds (200) => `connected=true`
* If it returns 200 but 0 secrets => still `connected=true`, but `reason="EMPTY_PROJECT"`
* Only show “not connected” for:

  * missing token / missing project id
  * 401 unauthorized
  * 403 forbidden
  * network error / timeout

### UI: show correct copy

* Connected: “Connected · 14 secrets”
* Connected but empty: “Connected · 0 secrets (project empty)”
* Not connected: “Not connected · 403 forbidden” etc.

**Stop showing “Not connected” unless the API is actually failing.**

---

## 2) Replace the current table columns with the correct ones

### Current problem

You’re showing a dev/infra table:

* Base URL
* configured
* reachable
* /health
* auth
* secret
* e2e

That’s not what you asked for.

### New default view: “Operational View”

Columns should be:

* **Service**
* **Description** (short 1-liner)
* **Last Run** (time + status)
* **Site** (domain)
* **Summary** (1 line “what it did”)
* **Key Metrics** (compact: “278 pages, 42 issues”)
* **Missing Outputs** (badge count)
* **Actions**: View, Runs, Test

### Add a toggle

* Operational View (default)
* Diagnostics View (advanced)

Only Diagnostics View shows base_url / health / auth / secret / e2e.

---

## 3) Make “Last Run” actually work (right now it’s still “No runs”)

### Backend: ensure service_runs exists and is being written

You already created `service_runs`. The missing piece is likely:

* nothing is writing to it yet, OR
* the UI query isn’t returning the right “last run per service per site”

### Required backend endpoints

#### A) last run per service for selected site

`GET /api/services/last-runs?site_id=...`

Returns:

```json
[
  {
    "serviceSlug": "crawl_render_service",
    "lastRun": {
      "id":"...",
      "status":"success",
      "finishedAt":"...",
      "siteDomain":"empathyhealthclinic.com",
      "summary":"Crawled 278 pages, found 42 issues...",
      "metrics":{"pages":278,"issues":42}
    }
  }
]
```

Implementation approach:

* query `service_runs`
* group by `service_slug`
* pick the latest `finished_at` for that `site_id`
* return map keyed by `service_slug`

#### B) run history

`GET /api/services/:slug/runs?site_id=...&limit=25`

#### C) run details (modal)

`GET /api/runs/:runId`

---

## 4) Ensure runs are actually created (proxy runs if needed)

Right now your system likely isn’t executing “real runs” yet, so you need **proxy run logging** whenever Hermes does an action.

### Add run logging on these events

* Refresh integrations calls
* Test All Services calls
* Any scheduled job triggers
* Any service call from Hermes to a worker endpoint

### Developer rule

Whenever Hermes hits a worker endpoint, wrap it:

1. Create `service_run` with `status="running"`
2. Perform call
3. Store:

* `summary`
* `metrics_json`
* `outputs_json`
* `status`
* `finished_at`

Even a lightweight run entry is better than “no runs”.

---

## 5) Add the “Service Explainer” panel exactly as requested

### Backend: add descriptions to services

In `services` inventory table add:

* `description_md` (text)

Seed it using the exact copy you provided.

### UI behavior

When you click a service row or a “View” action:

Open a side panel / modal:

#### Panel sections (in this order)

1. **Service Name**
2. **Description (markdown)** ← your explainer text
3. **Last Run** (status, time, duration, trigger)
4. **Last Run Summary** (what it did)
5. **What it returned** (metrics + highlights + missing outputs)
6. **Run History** (list of last 10)
7. Optional: “Diagnostics” accordion (base url, health, auth, secrets)

### Run detail modal

Clicking a run shows:

* inputs_json (collapsed)
* outputs_json expected vs actual vs missing
* metrics_json
* errors

---

## 6) Remove Bitwarden Secrets Manager from “Services” list (move to dependencies)

Bitwarden is not a worker service. It’s a dependency.

### Implementation

* Add `category` to services:

  * `worker`
  * `connector`
  * `planned`
  * `platform_dependency`

Bitwarden should be `platform_dependency` and displayed only in the Platform Dependencies panel.

---

## 7) Make the page useful even without full orchestration

Add top summary counts based on operational view:

* Services: 15
* Ran in last 24h: X
* Failing: Y
* Missing outputs: Z

These should be computed from `service_runs`, not health checks.

---

## 8) Acceptance criteria (must be true after changes)

* Bitwarden dependency shows “Connected” if Bitwarden API returns 200
* Default view no longer shows base_url/configured/reachable noise
* Every service shows:

  * Description snippet
  * Last Run time/status (or “Never ran”)
* Clicking a service opens the explainer + last run summary + run history
* Clicking a run opens details (inputs + outputs + metrics)
* Diagnostics details exist but are hidden by default

---

## 9) Implementation checklist (fast path)

1. Add `/api/platform/dependencies` and fix Bitwarden status logic
2. Add `description_md` to services + seed with your descriptions
3. Create `/api/services/last-runs` endpoint and wire UI
4. Add Service Detail panel (modal/drawer)
5. Change table to Operational View default + add Diagnostics toggle
6. Ensure proxy run logging exists for at least Test and Refresh actions

---

If you want, I can also produce the exact `servicesCatalog.ts` seed object with your full descriptions inserted (ready to paste), and the exact Drizzle query for “latest run per service per site” based on your `service_runs` schema.
