Yep — what you’re seeing is consistent with **the smoke test runner being fixed**, but the **“summary/missing counts” UI still reading stale or differently-shaped data**.

In other words: *the test is passing*, but the **roll-up fields that drive the list view + the integration “Missing” pill** aren’t being updated from the new worker-mode result.

Here’s the prompt to fix that properly (one-time), so the list view, modal summary, and toast all agree.

Fix Integrations UI “Missing” counts not updating after successful smoke tests.

Problem:

* Smoke test now passes and validates all expected outputs for Google Data Connector worker.
* Success toast says “all 9 outputs validated”.
* But the Integrations table still shows “9 missing”, and the integration modal still shows missing outputs.
  This indicates the UI is reading stale summary state or a different data source than the smoke test results.

Goal:
Whenever a smoke test run completes (pass/fail), Hermes must persist a normalized “integration status snapshot” and the UI must render from that snapshot (not cached/old fields).

Requirements:

1. Normalize smoke test results into a single canonical payload
   After a smoke test run finishes, compute:

* received_outputs: string[] (keys found in response.data)
* missing_outputs: string[] (expected_outputs - received_outputs)
* status: "success" | "failed"
* summary: human readable string
* last_run_at: timestamp
* diagnostics_run_id: string
* mode: "worker" | "oauth"
  Persist these as the “last known state” for that integration.

2. Persist to DB in one place
   Update the integration record (or integration_status table) with:

* last_status
* last_summary
* last_run_at
* last_received_outputs (json)
* last_missing_outputs (json)
* last_diagnostics_run_id
* last_duration_ms
  Make sure this write happens in the smoke test runner (the same code path that shows the success toast).

3. Ensure the list view uses the same fields
   Integrations table should read:

* missing count from last_missing_outputs.length
* status badge from last_status
* summary from last_summary
* metrics tags from mode/diagnostics_run_id
  No other “computed on the client” missing logic.

4. Fix caching / stale UI state
   If the UI uses React Query/SWR or a cached store:

* After a smoke test completes, invalidate:

  * integrations list query
  * integration details query for that integration
* Force re-fetch so the counts update immediately without reload.

5. Fix modal “WHAT IT RETURNED / Missing” panel
   The modal must render missing outputs from the same canonical fields used in the list view.
   If the modal currently renders from an older structure (e.g., “expected outputs” without referencing the latest run), update it to show:

* last_received_outputs
* last_missing_outputs
* last_run_at
* diagnostics_run_id

6. Guard for worker vs oauth
   If mode=worker:

* outputs live under response.data keys
  If mode=oauth:
* outputs may come from a different payload
  Normalize both into received_outputs/missing_outputs before persisting.

7. Add a small debug aid
   In integration modal, display:

* “Computed missing_count source: last_missing_outputs”
* “Last updated at: <timestamp>”
  So we can verify it’s using persisted snapshot.

Acceptance Criteria:

* Run smoke test → toast says validated 9 outputs → list view immediately shows 0 missing for that integration.
* Modal shows 0 missing and lists received outputs.
* No page refresh required.

Notes:

* Do not rely on old “Missing” computed values or cached defaults.
* The smoke test run that passes must always update the persisted snapshot.
