Yep — that’s exactly the symptom of the lineage/contract gap.

**Popular works because it’s the only one that currently has a full “home KPI pipeline”:**
worker output → normalized KPI with `crewId` + `kpiId` → stored → `getCrewOverview` → Mission Control card.

For everyone else (Scotty, Speedster, etc.), one of these is missing:

* the **primary KPI is defined** in the registry but
* the worker output is **not being normalized into that KPI ID**, or
* it’s not being **written to `crew_kpis` with the canonical `crewId`**, or
* Mission Control is querying a `kpiId` that never gets created.

### The fix pattern (applies to all 11 agents)

For each agent, you must do **exactly these 3 things**:

1. **Define a primary KPI in the registry**

* `crewId`
* `primaryKpi.id`
* label + unit

2. **Add a normalization adapter that always emits that KPI**

* `normalize<Agent>(workerResult) -> [{ crewId, kpiId: primaryKpi.id, value, measuredAt }]`

3. **Ensure the run/ingestion endpoint writes it to DB**

* insert into `crew_kpis` for the latest run
* Mission Control reads only from DB via `getCrewOverview`

If any agent is missing step (2), the homepage will show **no number**—by design.

---

## What each agent’s core KPI should be on the home page

These are the “one metric per crew” picks that work as a dashboard:

* **Scotty (Technical SEO):** `technicalHealthScore` (0–100)
* **Speedster (Performance):** `performanceScore` (0–100) *or* `worstLcpMs`
* **Sentinel (Content Decay):** `pagesLosingTraffic` (count)
* **Hemingway (Content Strategy):** `contentQualityScore` (0–100)
* **Atlas (AI Optimization):** `aiOptimizationScore` (0–100)
* **Socrates (Knowledge Base):** `insightsGenerated` (count, last 7d)
* **Lookout (SERP Tracking):** `keywordsUp` (count, last 7d) *or* `avgPosition`
* **Beacon (Authority):** `domainAuthority` (0–100) *or* `refDomains`
* **Natasha (Competitive Intel):** `keywordGapsFound` (count)
* **Draper (Paid Ads):** `conversions` (count, last 30d) *or* `cpa` (money)
* **Popular (Analytics):** already works (e.g., `monthlySessions`)

---

## Why Scotty is blank right now

Mission Control is likely requesting:

* `crewId="scotty"`
* `kpiId="technicalHealthScore"`

…but Scotty’s worker adapter is currently emitting something else (or nothing), like:

* `crawlHealth`, `indexCoverage`, `criticalIssues`

…and never creating the composite `technicalHealthScore`, so the UI has nothing to render.

---

## Copy/paste prompt for your vibe coding agent (super prescriptive)

You are a senior full-stack engineer. Popular is the only crew showing a home-page KPI; all other crews are blank. Fix this by enforcing a canonical “primary KPI” contract for every crew.

GOAL:
Every crew must show ONE core metric on Mission Control. This must be sourced from the canonical pipeline:
worker output → normalize to {crewId, kpiId} → store in crew_kpis → read via getCrewOverview → render in Mission Control.
No page may compute KPIs locally or use placeholders for active crews.

STEPS:

1. In shared/crew/crewRegistry.ts define primaryKpi for each crew:

* scotty: technicalHealthScore
* speedster: performanceScore
* sentinel: pagesLosingTraffic
* hemingway: contentQualityScore
* atlas: aiOptimizationScore
* socrates: insightsGenerated
* lookout: keywordsUp
* beacon: domainAuthority
* natasha: keywordGapsFound
* draper: conversions (or cpa)
* popular: monthlySessions (already works)

2. Create a per-crew adapter in server/crew/normalize/:
   normalizeScotty(result) -> emits KPI technicalHealthScore
   normalizeSpeedster(result) -> emits KPI performanceScore
   ...repeat for all crews.
   Each normalizeX MUST return an array of CrewKpi rows containing the primary KPI id from the registry.

3. Update POST /api/crew/:crewId/run:

* Calls the worker
* Validates output contract
* Calls normalizeX(workerResult)
* Inserts KPI rows into crew_kpis (with crewId and the exact kpiId)
* Stores a crew_runs row
* Returns ok + primary KPI value

4. Update GET /api/crew/:crewId/overview:

* Reads latest crew_runs + crew_kpis for that crewId
* Returns primary KPI based on crewRegistry[crewId].primaryKpi.id
* If missing, returns “no data yet” (but never fake values)

5. Update ALL crew pages and Mission Control to ONLY use /api/crew/:crewId/overview (no direct worker calls).

TESTS (must add):

* A contract test loops over all crewIds and asserts that after a mocked successful run, crew_kpis contains the crew’s primaryKpi.id.
* Fail CI if any crew lacks a primary KPI or its adapter does not emit it.

DELIVERABLE:
After running Scotty once, Mission Control must show Scotty’s number (technicalHealthScore). Repeat for all crews.

If you paste (or tell me) what Scotty’s worker currently returns (top-level keys like `crawl_summary`, `kpis`, etc.), I can tell you exactly how to compute `technicalHealthScore` from what you already have—so you don’t need to change the worker.
