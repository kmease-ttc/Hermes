You are a senior full-stack engineer working inside this Replit project.

Goal
Fix mission completion behavior on crew pages (starting with Socrates, but implemented generically so all crews benefit):

1. Add a “Recently Completed” section inside the Mission widget that shows ONLY the most recently completed mission/action.
2. Prevent completed missions from remaining clickable in “Next Actions”. After I click “Fix it” and it succeeds, that action must be marked completed and removed from Next Actions (or disabled), so I cannot spam-run the same mission indefinitely.
3. Show a completion timestamp for the last completed mission (relative time is fine).

Current bug
On Socrates, “Review and categorize findings” remains in Next Actions after a successful Fix it, so I can click Fix it repeatedly and get the same success behavior over and over. That must stop.

Constraints

* Do not rely on only client-side state. Completion must persist across refresh.
* Only show “completed” when the server confirms success (and for Socrates specifically, only after KB write is verified).
* Recently Completed shows only 1 item (the last completed mission).

Implementation plan

A) Data model: persist mission executions

1. Identify the existing audit/execution storage (Chronicle / Audit Log / drizzle table).

* If an executions table already exists, reuse it.
* Otherwise create a small table (drizzle) for mission executions:

  * id
  * siteId
  * crewId
  * missionId
  * status: "success" | "failed"
  * completedAt (timestamp)
  * summary (string) e.g. "KBase updated — 22 new insights"
  * metadata (json) includes counts/runId/etc.

B) Server endpoints
2) Add/confirm these endpoints exist:

* POST /api/missions/execute

  * input: { siteId, crewId, missionId }
  * executes the mission’s handler (existing code)
  * on success: writes an execution record with completedAt
  * returns: { ok, execution: { missionId, summary, completedAt }, effects... }

* GET /api/missions/state?siteId=...&crewId=...

  * returns:

    * nextActions (computed)
    * lastCompleted (single execution record)
    * completedMissionIds (or enough info to filter)
  * IMPORTANT: nextActions must exclude missions that are already completed recently (see cooldown below)

C) UI logic: Mission widget supports Recently Completed + filters next actions
3) Update the shared MissionOverview/Missions widget component:

* Add a “RECENTLY COMPLETED” section below Next Actions:

  * Show only 1 item:

    * mission title
    * completion time (e.g. “Completed 2m ago”)
    * optional summary (e.g. “KBase updated — 22 new insights”)
* Hide this section if nothing completed yet.

4. Ensure Next Actions cannot include missions that are already completed (at least recently)

* When rendering nextActions, filter out any mission whose missionId matches lastCompleted.missionId if completedAt is within a cooldown window.
* Cooldown window:

  * Default: 24 hours (so you can’t spam the same action endlessly)
  * If you need shorter for testing, use 5 minutes but make it configurable.

D) Button behavior
5) After a mission executes successfully:

* Disable the “Fix it” button immediately during the request (loading state).
* On success:

  * Remove the mission from Next Actions (optimistically), OR invalidate/refetch /api/missions/state.
  * Set Recently Completed to the returned execution.
  * Show toast: use execution.summary (and only if verified).
* On failure:

  * Keep in Next Actions and show error toast.

6. Prevent infinite re-run even across refresh

* The server must be the final authority:

  * When /api/missions/state is computed, it should not return missions that are within cooldown and already completed successfully.
* If a user manually calls execute again, the server should:

  * reject with 409 “Already completed recently” OR allow but only if “force” is present.
  * For now: reject by default. Return a message like:

    * “Already completed recently — try again later.”

E) Socrates-specific validation
7) For Socrates “Review and categorize findings”:

* Only record success when:

  * KB writeVerified === true
* Store metadata:

  * writtenCount, runId
* Use summary:

  * “KBase updated — {writtenCount} new insights”

F) Verification checklist
8) Validate on Socrates:

* Before: Next Actions shows “Review and categorize findings” with Fix it button.
* Click Fix it:

  * loading state shows
  * success toast
  * Next Actions no longer shows that mission
  * Recently Completed shows it with completion timestamp
* Refresh page:

  * Still not in Next Actions
  * Recently Completed still shows last completion
* Attempt to click Fix it again:

  * there is no Fix it for that completed mission
  * OR if accessible elsewhere, server returns 409 and UI shows “Already completed recently”.

Deliverables

* File paths changed
* The cooldown logic used (duration + where enforced)
* Screenshots/description of Socrates after fix showing Recently Completed + Next Actions no longer repeatable
