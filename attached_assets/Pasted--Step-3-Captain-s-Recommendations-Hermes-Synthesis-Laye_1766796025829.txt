## Step 3 — Captain’s Recommendations (Hermes Synthesis Layer)

### Goal

Add a **top-of-page** section on **Agents** that turns multiple agent signals into **one prioritized plan**. This is not a new page. It’s a single panel above the agent cards.

---

## 3.1 UI Structure (Top of Agents Page)

**Captain’s Recommendations**
Subtitle: “Based on X active agents • Last updated Y ago”

### Panel Contents

**A) Priority Actions (always 3 items)**
Each item is:

* **Title** (action-oriented)
* **Why this matters** (1 line)
* **Signals used** (which agents contributed)
* **Impact** (High / Medium / Low)
* **Effort** (S / M / L)
* **CTA** (View details → scroll to relevant agents)

**B) Confidence + Coverage**

* Confidence: High/Med/Low
* Coverage: “6/9 agents contributing data”
* Blocking issues: “2 agents need configuration”

**C) Trend Snapshot (optional but powerful)**

* “7d vs prior 7d”
* “30d vs prior 30d”
  Only show if Pulse (GA4) is active.

---

## 3.2 Data Contract for Captain Output

Hermes should return a single object:

```ts
interface CaptainsRecommendations {
  generated_at: string; // ISO
  contributing_agents: string[]; // ids
  coverage: { active: number; total: number; blocked: number; };

  priorities: {
    rank: 1 | 2 | 3;
    title: string;
    why: string;
    impact: "High" | "Medium" | "Low";
    effort: "S" | "M" | "L";
    agents: { id: string; name: string; }[];
    cta: { label: string; anchor: string; };
  }[];

  blockers: {
    id: string;
    title: string;
    fix: string;
  }[];

  confidence: "High" | "Medium" | "Low";
}
```

Panel renders from this. No special casing.

---

## 3.3 Synthesis Logic (How Hermes Builds Priorities)

### Inputs

Hermes consumes the normalized `AgentInsight` objects from Step 2.

### Rules to Generate Priorities

1. **Find cross-agent convergence**

   * If 2+ agents point to the same problem area (e.g., indexing + GA4 drop), elevate it.
2. **Weight by business impact**

   * GA4 conversion drop > blog cadence > minor CWV warnings
3. **Prefer “fix root causes”**

   * Crawl/index issues before content tweaks
4. **Always return exactly 3 priorities**

   * If not enough intelligence, fill remaining with “Foundational” items (e.g., “Run first scans” or “Connect missing credentials”)

### Recommendation Buckets (Simple + Reliable)

Hermes should assign findings into these buckets:

* **Revenue / Conversions** (Pulse GA4, Draper Ads)
* **Indexing / Crawlability** (Scotty, Lookout)
* **Authority / Links** (Beacon, Competitive Intel)
* **Content Growth** (BlogWriter, Content Decay)
* **Performance** (Speedster)

Then pick the top 3 by severity + convergence.

---

## 3.4 Example Output (What the User Sees)

**Captain’s Recommendations**
Based on 6 active agents • Updated 12 minutes ago

**Priority Actions**

1. Fix indexing for your top converting pages
   Why: GA4 shows conversions down and Technical SEO detected crawl blocks
   Signals: Pulse, Scotty
   Impact: High • Effort: S
   CTA: Review Scotty + Pulse

2. Publish a new blog targeting “Telepsychiatry Florida”
   Why: Blog cadence is slipping and SERP demand is strong
   Signals: BlogWriter, Lookout
   Impact: Medium • Effort: M
   CTA: Review BlogWriter

3. Acquire 2 local backlinks to beat competitors
   Why: Authority growth plateaued while competitors gained links
   Signals: Beacon, Natasha
   Impact: Medium • Effort: M
   CTA: Review Beacon + Natasha

**Blockers**

* Draper: Google Ads not connected → connect OAuth credentials
* Sentinel: Content Decay missing base URL → update config

Confidence: Medium • Coverage: 6/9

---

## 3.5 Persistence (Optional but Recommended)

Store the generated Captain output in your DB:

* `captains_recommendations` table keyed by `{site_id, generated_at}`
  So you can:
* show “what changed since last week”
* avoid blank panels if an agent is temporarily down

---

## 3.6 Implementation Checklist (Concrete)

1. Add endpoint: `GET /api/agents/captain?site_id=...`
2. Hermes collects latest `AgentInsight[]` for that site
3. Run synthesis rules → produce `CaptainsRecommendations`
4. Cache for 10–30 minutes per site
5. Render `<CaptainsRecommendations />` at top of Agents page
6. Add anchors so CTAs scroll to agent cards

---

If you want, I can also write the exact ranking heuristic (a simple scoring function) so Hermes consistently picks the right top 3 every time.
