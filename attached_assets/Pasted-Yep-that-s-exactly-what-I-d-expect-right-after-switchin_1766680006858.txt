Yep — that’s exactly what I’d expect right after switching the Google connector from **oauth → worker** in Hermes.

When it was OAuth, “Test Connection” was basically “do I have a token / can I refresh it?”.
Now that it’s a worker, “Test Connection” is almost certainly doing:

* load `{ base_url, api_key }` from Bitwarden
* call `GET {base_url}/health` (and/or `GET {base_url}/smoke-test`)
* validate JSON + auth

So the failure will be one of these **very specific buckets**. Here’s how to diagnose + fix fast.

---

## 1) Open the failing run’s diagnostics and look at the first failed stage

In Hermes → Integrations → Google Data Connector → **Test Connection** → open Diagnostics and find the first red stage.

### If it fails at **Config Loaded**

That means Hermes didn’t load the Bitwarden connection JSON for this integration.

**Fix in Hermes:** make sure the Google connector’s integration record points to the correct Bitwarden secret name/path (whatever Hermes uses, e.g. `connection_secret_name`, `bitwarden_secret_key`, etc.).

This is the most common mistake when flipping modes: you changed `mode=worker` but didn’t wire the worker connection secret.

What you want:

* Google connector (worker) has a `connection_secret` reference
* Hermes fetches it via `BWS_*` config

---

## 2) If it fails at **Endpoint Built / Request Sent**

Expand details and check:

* **URL** (should be `https://worker-google-services--providers2.replit.app/api/health`)
* **method** (GET)
* **status code**

### If status is **404**

Hermes is calling the wrong path. Two common causes:

* Hermes is calling `/health` not `/api/health` (or vice versa)
* Hermes is double-prefixing like `/api/api/health`

**Fix in Hermes:** in the worker runner, build URLs as:

* `healthUrl = base_url + "/health"` (NOT hardcoded `/api/health`)
  Because your Bitwarden base_url already includes `/api`.

Given your Bitwarden base_url is:
`https://worker-google-services--providers2.replit.app/api`

Hermes should call:

* `{base_url}/health`
* `{base_url}/smoke-test`

Not `/api/health`.

---

## 3) If it fails at **Auth Ready / Request Sent** with **401**

That means Hermes is reaching the worker but the worker is rejecting the key.

This only happens if either:

* Hermes isn’t sending the key (wrong header)
* Hermes is sending a different key than the worker expects

**Fix:**

* Hermes should send both:

  * `x-api-key: <api_key>`
  * `Authorization: Bearer <api_key>`
* Worker should accept either (you already implemented this pattern)

If you added fingerprints, the diagnostics should show:

* `hermes_key_fingerprint`
  and `/api/health` should return:
* `expected_key_fingerprint`

If those fingerprints differ, it’s a real mismatch between:

* Bitwarden `api_key`
  and
* worker `TRAFFIC_DOCTOR_API_KEY`

---

## 4) If it fails at **Response Type Validated**

That’s back to HTML/doctype — which means Hermes hit a non-API route again.

**Fix:** same as #2: ensure Hermes uses `{base_url}/health` and `{base_url}/smoke-test` where base_url already contains `/api`.

---

## The most likely root cause in your case

Because you just flipped the connector mode in Hermes, the two most common “oops” are:

1. **Hermes is still calling `/api/health` instead of `{base_url}/health`** (double `/api`)
2. **The integration didn’t get wired to the Bitwarden connection secret**, so Config Loaded fails

---

## What I need from you (tiny) to tell you exactly which fix

Open the failing Test Connection run and paste **just** the first failed stage details:

* stage name
* URL
* status code

No secrets. No keys.

With that, I can tell you the exact 1-line Hermes fix (URL builder vs secret mapping).
