Implement **API-key fingerprint validation** and **dual-header auth** so we can debug worker auth without ever copying full secrets.

Goal:

* Confirm whether Bitwarden’s api_key matches the worker’s expected key using fingerprints.
* Avoid manual comparison of long strings.
* Make Hermes compatible with workers expecting either `x-api-key` or `Authorization: Bearer`.

---

PART A — Hermes changes (orchestrator)

1. When loading any worker connector secret from Bitwarden:

   * Read `{ base_url, api_key }`
   * Compute `hermes_key_fingerprint = sha256(api_key)` and format as:
     first6 + "…" + last6 (example: "9f2c1a…a31b77")
   * Store `hermes_key_fingerprint` in diagnostics output (never store raw api_key)

2. When calling worker endpoints (/health, /smoke-test, /capabilities, /run):

   * Always send BOTH headers:

     * `x-api-key: <api_key>`
     * `Authorization: Bearer <api_key>`
   * Also send:

     * `Accept: application/json`
     * `X-Request-Id: <uuid>`

3. Diagnostics Pipeline updates:

   * In `auth_ready` stage details, show:

     * auth_headers_sent: ["x-api-key","authorization"]
     * hermes_key_fingerprint: "<fingerprint>"
   * In `request_sent` stage details, show:

     * url
     * status
     * content-type
   * If status is 401/403, set:

     * failure_bucket = "auth_failed"
     * suggested_fix = "Worker rejected the key or expects a different header. Compare fingerprints."

4. Worker fingerprint handshake:

   * Hermes must call `{base_url}/health` before smoke-test.
   * If /health returns `expected_key_fingerprint`, Hermes compares it to `hermes_key_fingerprint`.
   * If mismatch, fail early with a clear message:

     * "API key mismatch: Hermes <fp> vs Worker <fp>"

---

PART B — Worker changes (apply to Google Services Worker first, then all workers)

1. Add `expected_key_fingerprint` to GET /api/health (no auth):

   * Compute from the worker’s expected key:

     * `expected_key = process.env.TRAFFIC_DOCTOR_API_KEY || process.env.WORKER_API_KEY`
     * `expected_key_fingerprint = sha256(expected_key)` first6 + "…" + last6
   * Return JSON:
     {
     "ok": true,
     "service": "google_services_worker",
     "version": "1.0.0",
     "expected_key_fingerprint": "9f2c1a…a31b77"
     }

2. Update auth middleware to accept BOTH headers:

   * `x-api-key`
   * `Authorization: Bearer`
   * Compare against `expected_key`
   * On failure return JSON 401:
     { "ok": false, "error": { "code":"unauthorized", "message":"Invalid API key" } }

3. Ensure all /api routes return JSON only (no HTML).

---

PART C — Verification steps (no secret sharing required)

1. In Hermes, run Smoke Test for Google Data Connector worker.
2. Open diagnostics:

   * Confirm Hermes shows `hermes_key_fingerprint`
   * Confirm /health shows `expected_key_fingerprint`
3. If fingerprints match, auth is correct and smoke test should proceed.
4. If fingerprints mismatch:

   * Update either Bitwarden api_key or worker expected key (TRAFFIC_DOCTOR_API_KEY) to align.

Security requirements:

* Never log raw keys.
* Only fingerprints may be shown.
* Redact any Authorization headers in logs.
