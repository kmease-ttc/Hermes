Fix “Connect GA4” CTA + empty-state logic for Key Metrics: these KPIs are sourced via Popular. If Popular is missing/not configured, the UI must say “Hire/Configure Popular” (not “Connect GA4”). Only show “Connect GA4” when Popular is present AND GA4 is actually disconnected.

What’s wrong (from screenshot)

* Key Metrics cards (Conversion Rate, Bounce Rate, Monthly Sessions) show:
  “GA4 not connected…” + button “Connect GA4”
* But GA4 connectivity is not a direct user action from the homepage; it’s mediated through Popular.
* This is violating the “no dead ends / correct remediation prompt” rule: the CTA is pointing to the wrong fix.

Correct behavior (decision tree)
For each KPI card that depends on GA4 via Popular, the empty state must be driven by the actual dependency status:

Inputs needed:

* isPopularHired (or enabled)
* popularStatus: "ready" | "needs_setup" | "integration_down" | "error"
* ga4Status (as reported by Popular): "connected" | "needs_auth" | "needs_config" | "error"
* hasKpiData (from DB): true/false

Decision tree (in priority order)

1. If Popular is NOT hired/enabled:

   * Message: “Popular isn’t enabled for this site.”
   * Primary CTA: “Hire Popular”
   * Secondary CTA: “Learn what Popular does”
2. Else if Popular is hired but NOT configured/ready:

   * Message: “Popular needs setup to fetch GA4 metrics.”
   * Primary CTA: “Configure Popular”
   * Secondary CTA: “View Popular status”
3. Else if Popular is ready but GA4 is not connected (per Popular):

   * Message: “GA4 isn’t connected for this site.”
   * Primary CTA: “Connect GA4 in Popular”
   * Deep link to /popular/setup or /integrations/google (scoped to site)
4. Else if Popular + GA4 connected but KPI data is missing/stale:

   * Message: “No recent GA4 KPI data yet.”
   * Primary CTA: “Run Popular now”
   * Secondary CTA: “View Popular logs”
5. Else (data present):

   * Render KPI value + trend normally

Implementation details
A) Stop the KPI cards from hardcoding GA4 as the owner
Right now the card copy is “GA4 not connected or no data” and CTA is “Connect GA4”.
Replace with dependency-aware meta from the server.

B) Add a single “KPI dependency resolver” on the server
Dashboard endpoint should return each metric with meta including the correct owner + actions:

Example response shape for each KPI:
{
id: "bounceRate",
label: "Bounce Rate",
data: { value: null, trendPct: null },
meta: {
status: "needs_setup" | "needs_integration" | "empty" | "ok",
owner: "popular",
reason_code: "POPULAR_NOT_ENABLED" | "POPULAR_NOT_CONFIGURED" | "GA4_NOT_CONNECTED" | "NO_RECENT_DATA",
message: "Popular isn’t enabled for this site.",
actions: [
{ id: "hire_popular", label: "Hire Popular", kind: "route", route: "/crew/popular" }
]
}
}

C) Update MetricCard to render the server-provided actions

* If meta.status != "ok":

  * show meta.message
  * render primary action button = meta.actions[0]
  * render secondary actions as links if provided
* Remove any client-side assumption that GA4 is the fix.

D) Popular must expose “integration status” for Google services
Popular should publish a readiness object used by the dashboard:

GET /api/crew/popular/readiness?site_id=...
returns:
{
hired: true/false,
configured: true/false,
integrations: {
ga4: { status: "connected"|"needs_auth"|"needs_config"|"error", last_ok_at, last_error },
gsc: { ... }
},
last_run_at,
can_run_now: true/false
}

Dashboard uses this to choose the correct message + CTA.

Copy changes for the KPI cards
Replace “GA4 not connected…” with:

* “Popular isn’t enabled for this site.” (Hire Popular)
* “Popular needs setup to fetch GA4 metrics.” (Configure Popular)
* “GA4 connection needs attention in Popular.” (Go to Popular Setup)
* “No recent Popular data yet.” (Run Popular)

Acceptance criteria

* If Popular is not enabled, the KPI cards never show “Connect GA4”.
* If Popular is enabled but not configured, KPI cards show “Configure Popular”.
* If Popular is configured but GA4 auth/config is missing, KPI cards link to the Popular integration/setup path.
* If Popular is healthy, KPI cards show real values (and never “—” without a remediation action).

Quick patch suggestion (minimal change)
If you need a fast fix before the full meta pipeline:

* Replace the “Connect GA4” button with:

  * “Review Popular” deep link
* Replace the message with:

  * “Popular is required to load GA4 metrics.”
    Then implement the full decision tree next.

Deliverable

* One PR updating:

  1. Dashboard KPI meta generation (dependency-aware)
  2. MetricCard rendering to use actions from meta
  3. Popular readiness endpoint (or reused existing)
  4. Copy + links so the user always lands on the correct fix path
