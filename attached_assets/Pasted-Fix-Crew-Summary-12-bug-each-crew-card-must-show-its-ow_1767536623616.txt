Fix Crew Summary “-12%” bug: each crew card must show its own unique delta derived from that crew’s primary KPI, not a shared/placeholder value.

What’s wrong

* All crew summary cards show “-12%”, which indicates the card footer metric is coming from:

  1. a hardcoded placeholder, OR
  2. a shared field in the dashboard response that’s being reused for every card, OR
  3. a component-level default that’s applied when the real delta is missing (and it’s incorrectly identical across crews).

Required behavior

* Each crew card must display a unique delta (or status) based on that crew’s own “primary KPI” and time window.
* If a crew can’t compute a delta, the card must still render and show an actionable “Needs setup / No data” state (no dead ends).

Define primary KPI per crew (example mapping)
Use a server-owned mapping so it’s consistent everywhere:

Natasha (Competitive Intel): SERP position change or SOV change
Lookout (Technical SEO): count of critical issues change, or health score change
Popular (Analytics): organic sessions change (GA4) or conversion rate change
Scotty (Security/Headers): count of failing headers change or security score change
Speedster (Performance): CWV pass rate change or LCP change
Sentinel (Indexing/Crawl): indexed pages change or crawl errors change (GSC)
Hemingway (Content Strategy/Decay): decayed pages count change or content score change
Beacon (Authority/Backlinks): referring domains change or backlink score change
Atlas (Site Health/Platform): overall health score change or job success rate change
Draper (Ads): spend change or conversions change
Socrates (Knowledge Base): coverage/completeness change or freshness change

Implementation approach (server first)

1. Update the dashboard/crew summary API to return per-crew metrics explicitly.
   Do NOT compute deltas in the client.

Endpoint (existing or new):
GET /api/dashboard/crew-summary

Response shape:
{
website: { id, domain },
time_window: { label: "last_30_days", start: "YYYY-MM-DD", end: "YYYY-MM-DD" },
crews: [
{
crew: "popular",
title: "Popular",
score: 50,
primary_metric: {
id: "ga4_sessions",
label: "Organic Sessions",
current_value: 5237,
baseline_value: 9099,
delta_pct: -42.4,
trend: "down",
status: "ok" | "empty" | "needs_setup" | "error",
reason_code?: "...",
actions?: [...]
}
},
...
]
}

2. Ensure each crew has a compute function that returns its primary_metric from DB:

* computePopularPrimaryMetric(websiteId, window)
* computeSpeedsterPrimaryMetric(websiteId, window)
* etc.

Rules:

* delta_pct must be computed consistently: (current - baseline) / baseline * 100
* If baseline_value is 0 or missing, set status="empty" and provide actions
* Never return a default delta like -12 unless status explicitly says “placeholder” (but we should avoid placeholders entirely)

Client-side fixes

1. CrewCard component must read crew.primary_metric.delta_pct for the percentage badge.
2. Remove any fallback that renders “-12%” when the value is missing.

* If primary_metric.status != "ok", render an inline mini empty-state:

  * Title: “Needs setup”
  * Body: primary_metric.reason_code/user_message
  * CTA: primary_metric.actions[0]

3. Ensure the badge color/trend arrow is derived from trend, not hardcoded.

Likely root cause (what to look for)

* A line in the UI like:
  const delta = data?.deltaPct ?? -12
  or
  const delta = dashboard.summary.deltaPct (single field) applied to all cards
* Or a shared mocked object being reused for each crew.

Fix by:

* Removing the default
* Moving delta computation to per-crew server response

Acceptance criteria

* On the dashboard, at least two different crew cards show different % values (or different statuses).
* Popular’s card delta matches the Popular details page primary metric (same method/window).
* If a crew lacks data, it shows “Needs setup / No data” with a CTA instead of a fake percentage.
* No crew card ever shows “-12%” unless the real computed delta is actually -12.0%.

Quick verification test

* Add a temporary console log on the dashboard API response: print crews.map(c => [c.crew, c.primary_metric.delta_pct, c.primary_metric.status])
* Confirm values differ across crews.
* Confirm missing crews return status != ok and include actions.

Deliverable

* One PR that:

  1. updates the server response to include per-crew primary_metric
  2. removes client placeholder delta logic
  3. updates CrewCard to render delta or actionable empty state
  4. adds a small test (or snapshot) to prevent reintroducing a constant delta across crews
