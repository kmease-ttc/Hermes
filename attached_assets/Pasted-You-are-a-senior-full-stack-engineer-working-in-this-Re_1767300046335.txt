You are a senior full-stack engineer working in this Replit project (Hermes SEO / Arclo UI).

Task
On Natasha’s page (Competitive Intelligence / competitive snapshot), the KPI cards for **Average Rank** and **Share of Voice** are currently blank. Make them always show a real score (number / percent), not empty.

Requirements

1. **Never render blanks**

* If data is missing, show a deterministic fallback value (e.g., `0`, `—` is NOT allowed).
* KPIs should show:

  * Average Rank: numeric (e.g., `14.2`)
  * Share of Voice: percent (e.g., `23%`)

2. **Source of truth**

* Prefer values from the competitive snapshot response if present.
* If not present, compute locally from the keyword ranking data already used on the page.

Implementation steps
A) Find where Natasha page KPIs are rendered

* Locate the Natasha competitive snapshot page component (route currently appears to be `/agents/competitive_snapshot`).
* Identify the KPI card component and the exact props/fields used for:

  * avg rank (often `avgRank`, `averageRank`, `avg_rank`)
  * share of voice (often `shareOfVoice`, `share_of_voice`, `sov`, `shareUserVoice`)

B) Normalize the payload into a single `kpi` object

* Create a helper function (or selector) that returns:

  * `avgRank: number`
  * `shareOfVoicePct: number` (0–100)
* Ensure it maps multiple possible field names safely.

Example normalization (adjust field names to match actual code):

* avg rank candidates: `data.avgRank ?? data.avg_rank ?? data.metrics?.avgRank ?? data.kpis?.avgRank`
* share of voice candidates:

  * `data.share_of_voice` can be:

    * number (already percent)
    * object (use `target_sov` as percent)
  * also check `data.shareOfVoice ?? data.metrics?.shareOfVoice ?? data.kpis?.shareOfVoice`

C) Local fallback computation (when missing)

1. Average Rank

* Use the tracked keyword ranking list for Natasha (whatever the page uses to render “Competitor Rankings / SERP Recon / keywords”).
* Compute average of valid ranks only:

  * Include ranks > 0 and finite.
  * If nothing valid, return `0`.

2. Share of Voice (percent)

* Implement a simple visibility score from ranks, then convert to percent.
* Recommended weighting (keep consistent everywhere):

  * Rank 1–3: 1.0
  * Rank 4–10: 0.7
  * Rank 11–20: 0.3
  * Rank 21+: 0.1
  * Not ranking / missing: 0
* `shareOfVoicePct = round( (sum(weights) / totalKeywords) * 100 )`
* If `totalKeywords` is 0, return `0`.

D) Rendering rules

* Format:

  * Avg Rank: 1 decimal place (e.g., `avgRank.toFixed(1)`)
  * Share of Voice: integer percent (e.g., `${shareOfVoicePct}%`)
* Ensure KPIs update after “Run Analysis” completes, and also on initial load if cached data exists.

E) Fix the naming mismatch that’s causing blanks

* There’s a strong chance the UI is reading `AverageRank` or `ShareUserVoice` while the computed fields are named `avgRank` / `shareOfVoice`.
* Make the KPI cards consume the normalized `kpi.avgRank` and `kpi.shareOfVoicePct` fields directly.

Acceptance criteria

* On Natasha page, **Average Rank** KPI always shows a number (not blank).
* **Share of Voice** KPI always shows a percent (not blank).
* Clicking “Run Analysis” updates both KPIs without requiring a refresh.
* No console errors and no NaN displayed; if input is missing/invalid, fall back to `0` and `0%`.

Do it now

* Implement the normalization + fallback calculations.
* Wire the KPI cards to the new normalized values.
* Add a small unit test or lightweight runtime assertion to prevent regressions (e.g., `Number.isFinite(avgRank)`).
* Commit message: `fix(natasha): populate avg rank and share of voice KPIs`
