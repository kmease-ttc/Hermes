Replit Prompt: Make “Compare to Industry Benchmarks” Actually Useful (Show Industry Baselines + Delta, Hook Up Clicks/Impressions/CTR/Position from DB)

Problem
The “Compare to Industry Benchmarks” section on Mission Control is not useful right now:

* It shows raw values (e.g., Total Sessions 96,364) without any comparison to an industry baseline.
* Clicks/Impressions/CTR/Avg Position show 0 or blank even though we already have this data (either via GSC/GA4 or stored in DB).

Goal
Turn this into a real comparison module:

1. Display the site’s metrics for a defined date range.
2. Display estimated industry benchmark values for the same metric.
3. Display delta (absolute + percentage) and a clear “Good / Watch / Needs Improvement” label.
4. Ensure clicks/impressions/CTR/avg position are populated from stored data (DB), not dependent on live API availability.

Part 1 — Define the comparison model
For each metric card (Sessions, Clicks, Impressions, CTR, Avg Position):
Show:

* “You” value (current site, selected date range)
* “Industry” value (estimated benchmark for chosen industry)
* Delta:

  * absolute difference
  * percent difference
* Status chip:

  * Good / Watch / Needs Improvement
* Context line:

  * “Based on data from YYYY-MM-DD to YYYY-MM-DD”
  * “Industry baseline: Psychiatry / Mental Health (estimated)”

Part 2 — Hook up real metric values (from DB, not placeholders)

1. Create/extend a backend endpoint to return benchmark-ready metrics:
   GET /api/benchmarks/summary?siteId=...&from=...&to=...

Return:
{
siteId,
from, to,
metrics: {
sessions: { value: n, source: "ga4", lastUpdatedAt: "..." },
clicks: { value: n, source: "gsc", lastUpdatedAt: "..." },
impressions: { value: n, source: "gsc", lastUpdatedAt: "..." },
ctr: { value: 0.xx, source: "gsc", lastUpdatedAt: "..." },
position: { value: x.x, source: "gsc", lastUpdatedAt: "..." }
}
}

2. Read from persisted tables
   Do NOT rely on live calls in the UI.
   If connectors already store outputs, load the latest aggregated results for the range.
   If not currently stored, implement a simple storage layer:

* On each successful GA4/GSC run, persist daily aggregates:

  * ga4_daily(siteId, date, sessions, users, conversions, ...)
  * gsc_daily(siteId, date, clicks, impressions, ctr, position, ...)
    Then the summary endpoint sums/averages across the date range.

3. Fix “0 clicks/impressions” bug
   If data exists but UI shows 0:

* verify the query path used by Mission Control uses the same siteId and date range as the stored data
* ensure the backend is returning real values (not default 0)
* ensure the frontend is mapping response fields correctly

Part 3 — Add industry benchmark estimation (server-side)
We need benchmark baselines. If we don’t have a dataset, implement a pragmatic first version:

1. Create a simple industry benchmark config table or JSON:

* industry_benchmarks(industryKey, metric, p25, p50, p75, p90, unit, notes, sourceName, sourceYear)
  Example metrics:
* sessions/month
* clicks/month
* impressions/month
* ctr
* avg position

2. Normalize benchmark values to the same time window
   If your benchmarks are “monthly” and user selects a 7-day window:

* convert benchmark to daily rate and scale to selected range length
* for CTR and Position, use the benchmark value directly (not scaled)

3. Return baseline + percentile bands
   The UI should display:

* baseline (use p50 by default)
* optionally show p25/p50/p90 labels on the gradient bar (like your slider UI)

Endpoint should return:
{
benchmarks: {
sessions: { p25, p50, p90 },
clicks: { p25, p50, p90 },
...
}
}

Part 4 — Compute deltas + status labeling
For each metric:

* delta = you - industry(p50)
* deltaPct = (you - industry) / industry
* Status:

  * For “higher is better” metrics (sessions, clicks, impressions, ctr):

    * Good if you >= p50
    * Watch if between p25 and p50
    * Needs Improvement if < p25
  * For “lower is better” metrics (position):

    * Good if you <= p50
    * Watch if between p50 and p75
    * Needs Improvement if > p75
      (Use sensible rules, but keep it simple.)

Part 5 — Update the UI
Replace the current “Compare to Industry Benchmarks” rows with the same Key Metric card styling:
Each card shows:

* metric name
* you value (big)
* industry value (smaller label)
* delta (+/- with %)
* status chip
* optional benchmark slider bar with p25/p50/p90 + your dot (and ensure dot is clamped inside track)

Also:

* Make the industry dropdown actually change the benchmark set (Psychiatry/Mental Health etc.)
* Make the date range visible and consistent (show “from-to” clearly)

Acceptance criteria

* Sessions shows “You”, “Industry”, and % delta.
* Clicks/Impressions/CTR/Avg Position populate with real stored values (not 0) when data exists.
* If API is down, the page still works because it uses DB aggregates.
* The section instantly communicates performance vs baseline (good/watch/needs improvement).
* Industry baselines are estimated but transparent (“estimated” + source/year shown in a tooltip or footnote).

Deliverables

* DB storage for GA4/GSC aggregates (if missing)
* /api/benchmarks/summary endpoint returning real site metrics for range
* Industry benchmark dataset (starter config) + scaling logic
* UI updated to show baseline + deltas + status
