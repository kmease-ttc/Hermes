You are a senior full-stack engineer working inside this Replit project.

Goals (Socrates / Knowledge Base)

1. Mission widget behavior:

* Add a “Recently Completed” section (single item) inside the Missions widget.
* After clicking “Fix it” for “Review and categorize findings”, that mission must be marked completed and removed from Next Actions (or disabled) so it cannot be spam-run repeatedly.
* Show a completion timestamp next to the recently completed item (e.g., “Completed 2m ago” or date).

2. Populate Socrates “Insights” and “Recommendations”

* “Insights” must be synthesized learnings aggregated across ALL agents (patterns/themes, cross-agent observations).
* “Recommendations” must be actionable fixes derived from those learnings (prioritized tasks to execute).
* Both tabs must render real lists (not empty placeholders), using data that exists in the KB worker or generated via the app if missing.

Constraints

* No fake completion. Mark completed only after server confirms success (and for Socrates, only after KB writeVerified).
* Prevent repeat execution via server-side cooldown (not just client state).
* Keep consistent with existing patterns (react-query invalidation, audit logging, etc.).

A) Mission completion + Recently Completed

1. Server-side enforcement (must)

* Add or update mission execution tracking so the server can answer:

  * What is the last completed mission for this crew/site?
  * Which missions are currently eligible to run?
* Implement:

  * POST /api/missions/execute { siteId, crewId, missionId }
  * GET /api/missions/state?siteId=...&crewId=...
    Return model:
    {
    nextActions: Mission[],
    lastCompleted: { missionId, title, summary, completedAt } | null
    }

2. Cooldown / anti-spam

* If a mission was completed successfully within the cooldown window (default 24h; make it configurable), exclude it from nextActions.
* If user tries to execute again within cooldown, return 409 with message “Already completed recently”.

3. UI changes

* Update the shared Missions/MissionOverview widget:

  * Keep “Next Actions”
  * Add “RECENTLY COMPLETED” below it
  * Show only one item: the lastCompleted mission with timestamp and summary
* After a successful execute, invalidate /api/missions/state and refresh the widget so:

  * mission disappears from Next Actions
  * appears in Recently Completed

B) Insights + Recommendations population (Socrates)

1. Define the data shape
   Insights item:

* id
* title
* summary
* tags (optional)
* sources: [{ crewId, learningId }]
* createdAt

Recommendation item:

* id
* title
* rationale (ties back to insight/learnings)
* priority: high/med/low
* effort: s/m/l (optional)
* suggestedActionType (optional) e.g. “content_update”, “tech_fix”, “ads_change”
* sources: [{ crewId, learningId }]
* createdAt

2. Confirm KB worker capabilities / endpoints

* Identify existing KB worker endpoints for:

  * listing learnings (already working)
  * listing insights
  * listing recommendations
  * synthesizing insights/recommendations (if supported)
    If they exist:
* Wire the UI tabs to GET /api/kb/insights and GET /api/kb/recommendations proxies.
  If they do NOT exist:
* Implement server-side synthesis as a fallback (see below) and persist results.

3. Synthesis pipeline (preferred)
   On Socrates “Fix it” (Review & categorize findings) success:

* Step 1: Pull latest learnings across agents (you already have 176 learnings showing)
* Step 2: Produce Insights:

  * cluster/group learnings by theme (basic approach: keyword/topic clustering + crew tags)
  * create 5–20 insights max, newest-first
* Step 3: Produce Recommendations:

  * map clusters to actionable fixes (e.g., “Improve LCP by optimizing hero image”, “Fix structured data”, etc.)
  * prioritize by impact and recurrence across agents
* Step 4: Write Insights + Recommendations back to KB store (worker write endpoint if supported; otherwise app DB)
* Step 5: Return counts + IDs to UI:

  * { insightsAdded, recommendationsAdded, totals }

4. Minimal viable implementation (if you need a quick win)
   If the worker doesn’t support synthesis yet:

* Implement synthesis in the app using the OpenAI integration you already have:

  * Send top N learnings (with titles/snippets/crewId) to the model
  * Ask for:

    * a list of insights (themes/patterns)
    * a list of recommendations (actionable fixes)
* Persist results in DB tables:

  * kb_insights
  * kb_recommendations
    Key: make it deterministic-ish by using a stable prompt and a fixed temperature.

5. UI wiring

* Update Socrates tabs:

  * Learnings: already populated
  * Insights: render insight cards list with title + summary + source chips (crew badges)
  * Recommendations: render actionable cards with priority pill + “Fix it” button hook (optional now, but wire later)
* Add empty states:

  * “No insights yet — run Review & categorize findings to generate insights.”
  * “No recommendations yet — generate insights first.”

6. Verification

* Click “Fix it” once:

  * Mission moves to Recently Completed
  * Insights tab shows items (count > 0)
  * Recommendations tab shows items (count > 0)
  * Key Metrics update: Insights and Recommendations counts reflect totals
* Refresh page:

  * Insights and Recommendations persist
  * mission remains completed until cooldown expires

Deliverables

* File paths changed
* Endpoints implemented/used
* How data is stored (worker vs app DB) and how write verification works
* Screenshot/description: Socrates shows Learnings, Insights, Recommendations populated and mission completion behavior fixed
